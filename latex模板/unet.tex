\documentclass{beamer}%[fleqn,usenatbib]{mnras}
\setbeamertemplate{itemize items}[square]
\mode<presentation>{
\usetheme{Madrid}
}
%\usepackage{cite}
\usepackage{natbib}
\usepackage{enumitem}
\usepackage{setspace}
%\usepackage{enumerate}
\setbeamertemplate{footline}[page number]
\setbeamertemplate{navigation symbols}{}%去掉页面底部的导航符号
%\usepackage{tikz}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{booktabs}
%\usepackage[fontset=windows]{ctex}
\usepackage{ctex}
\usepackage{multicol}
\usepackage{setspace}
\usepackage{animate}

%\usefonttheme[onlymath]{serif}
\usefonttheme{serif}
\usepackage{bm}
%\usepackage{algorithm}
\usepackage[ruled]{algorithm2e}
\usepackage{algorithmic}
\usepackage{verbatim}
\usepackage{ulem}
\usepackage{bm}
\usepackage{multicol}
\usepackage{graphicx} %插入图片的包
\usepackage{wrapfig}
\usepackage{subfig}
\usepackage{caption}
\usepackage{multirow}
\titlegraphic{\vspace{0.28\textheight}\flushleft{\hspace{-0.02\textwidth}\includegraphics[height=0.1\textwidth]{logo.png}}}
\usepackage{ulem}
\newcommand{\revise}[1]{\textcolor[rgb]{1.00,0.00,0.00}{{}#1}}
\newcommand{\reviseok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{}#1}}
%\newcommand{\proeric}[1]{\textcolor[rgb]{1.00,0.00,1.00}{{}#1}}
\newcommand{\proericok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{}#1}}
\renewcommand\tablename{表}
\renewcommand\figurename{图}
\renewcommand{\arraystretch}{1.4}
\setbeamertemplate{caption}[numbered]
\usepackage{listings}
\usepackage{xcolor}
\lstset{
    language         = Python,                          %代码语言使用的是python
    frame            = shadowbox,                       %把代码用带有阴影的框圈起来
    rulesepcolor     = \color{red!20!green!20!blue!20}, %代码块边框为淡青色
    keywordstyle     = \color{blue!90}\bfseries,        %代码关键字的颜色为蓝色，粗体
    commentstyle     = \color{red!10!green!70}\textit,  % 设置代码注释的颜色
    showstringspaces = false,                           %不显示代码字符串中间的空格标记
    numbers          = left,                            % 显示行号
    numberstyle      = \tiny,                           % 行号字体
    stringstyle      = \ttfamily,                       % 代码字符串的特殊格式
    breaklines       = true,                            %对过长的代码自动换行
    extendedchars    = false,                           %解决代码跨页时，章节标题，页眉等汉字不显示的问题
    %escapebegin     = \begin{CJK*},                    escapeend = \end{CJK*}, % 代码中出现中文必须加上，否则报错
    texcl            = true,
    escapeinside     = ``,
    xleftmargin      = 1em,
    xrightmargin     = 1em,
    aboveskip        = 1em
}

\def\IDM{IDM}
\def\PR{PR}

\title[Unet and images segmentation]{图像语义分割与U-net模型}
%\tiny \scriptsize \footnotesize \small \normalsize \large \Large \LARGE \huge \Huge
\author{\large 李乡儒} %{\scriptsize Email: xiangru.li@qq.com}}
\institute[SCNU]{\small
华南师范大学计算机学院
%国家气象中心
}
\date{\today}
%\data{2020年11月26日}

\begin{document}
\graphicspath{{figures/}}

\begin{frame}%[plain]          %“帧”的开始（帧即是一页幻灯片）
	\titlepage
	%\vspace{-2cm}
	%{\setlength{\baselineskip}{-6pt}
	%{\noindent \tiny{Qingguo Zeng, Xue Chen, Xiangru Li*, Jinlin Han, Chen Wang, Dejiang Zhou, Tao Wang.  Radio Frequency Interference Mitigation based on ArPLS and SumThreshold. Monthly Notices of the Royal Astronomical Society ,Volume 500, Issue 3, January 2021, Pages 2969–2978.}}}
\end{frame}

\begin{frame}[allowframebreaks]
    \frametitle{\textsc{目录}} \vspace{-0.3cm}
    \begin{spacing}{0.0}
        \tableofcontents[hideallsubsections]
    \end{spacing}   % 若不想要目录, 注释掉该句
\end{frame}

\begin{frame}[allowframebreaks]
    \vspace{-0.2cm}
    {\noindent\large\textbf{内容概要}}
    \vspace{0.4cm}
    \begin{itemize}
        \item[*] 图像分割问题
        \item[*] 数据特点与评价指标
        \item[*] 类别不平衡问题
        \item[*] U-net的基本原理
        \item[*] 上采样与特征融合
        \item[*] 实现要点
        \item[*] 应用实例
    \end{itemize}
\end{frame}

\input{sections/1}
\input{sections/2}
\input{sections/3}




\section{损失函数、目标函数、权重函数}

\begin{frame}[allowframebreaks]
  \frametitle{\textsc{目录}} \vspace{-0.3cm}
    \begin{spacing}{0.0}
        \tableofcontents[currentsection,hideallsubsections]
    \end{spacing}   % 若不想要目录, 注释掉该句
\end{frame}



\begin{frame}
\vspace{-0.1cm}
{\noindent\large\textbf{损失函数与目标函数}}
\vspace{0.4cm}

交叉熵(Cross Entropy)。对于一个样本$\mathbf{x}$的类别估计
{\setlength\abovedisplayskip{0.1cm}
\setlength\belowdisplayskip{0.1cm}
\begin{equation*}
    \begin{split}
    h_{\mathbf{\theta}}(\mathbf{x}) &= (P(y_1=1|\mathbf{x}), P(y_2=1|\mathbf{x}), \cdots, P(y_K=1|\mathbf{x})).\\
                                    &= (p_1 (\mathbf{x}), p_2 (\mathbf{x}), \cdots, p_K(\mathbf{x}))
    \end{split}
\end{equation*}
}
和参考信息
%{\setlength\abovedisplayskip{0.1cm}
%\setlength\belowdisplayskip{0.1cm}
%\begin{equation*}
    $\mathbf{y} = (y_1, y_2, \cdots, y_K),$
%\end{equation*}
%}
它们之间的交叉熵是
{\setlength\abovedisplayskip{0.1cm}
\setlength\belowdisplayskip{0.1cm}
\begin{equation}\label{equ:cross_entropy}
    \begin{split}
    H(\mathbf{y}, h_{\mathbf{\theta}}(\mathbf{x})) &= -(y_1 \log P(y_1=1|\mathbf{x}) + \cdots + y_K \log P(y_K =1|\mathbf{x}))%\\
%                                                   &= -\sum\limits_{k=1}^{K}{y_k \log P(y=k|\mathbf{x})}.
    \end{split}
\end{equation}
}


\begin{figure}
   \vspace{-0.2cm}  %调整图片与上文的垂直距离
   \setlength{\belowcaptionskip}{-0.4cm}   %调整图片标题与下文距离
   \setlength{\abovecaptionskip}{0.4cm}   %调整图片标题与下文距离
  \centering%
    \hspace{2.5cm}\includegraphics[width=0.6\linewidth]{one-hot-encoding.png}
%\caption*{\footnotesize{The origin of the term ‘early-type’ lies with the original interpretation of the Hubble tuning fork diagram. This assumed that galaxies evolved from the left (early-type ellipticals) to the right (late-type spirals) in a sequence.
%}}
%\label{fig:fastdata}
\end{figure}
{\setlength\abovedisplayskip{0.1cm}
\setlength\belowdisplayskip{0.1cm}
\begin{equation}\label{equ:cross_entropy}
    \begin{split}
    H(\mathbf{y}, h_{\mathbf{\theta}}(\mathbf{x})) &= -\log P(y_{l(\mathbf{x}))} = 1|\mathbf{x})\\
                                                   &= -\log p_{l(\mathbf{x}))}(\mathbf{x}))
    \end{split}
\end{equation}
}

\end{frame}

\begin{frame}
\vspace{-0.1cm}
{\noindent\large\textbf{损失函数与目标函数}}
\vspace{0.4cm}

{\setlength\abovedisplayskip{0.1cm}
\setlength\belowdisplayskip{0.1cm}
\begin{equation}\label{equ:cross_entropy}
    \begin{split}
    H(\mathbf{y}, h_{\mathbf{\theta}}(\mathbf{x})) &= -\log P(y_{l(\mathbf{x})}=1)|\mathbf{x})\\
                                                   &= -\log p_{l(\mathbf{x}))}(\mathbf{x}))
    \end{split}
\end{equation}
}

\begin{equation}\label{equ:cross_entropysimplized}
   E = -\sum\limits_{\mathbf{x} \in \Omega} log(p_{l(\mathbf{x}))}(\mathbf{x})))
\end{equation}

\begin{equation}\label{equ:unetobj}
   E = -\sum\limits_{\mathbf{x} \in \Omega} w(\mathbf{x}) log(p_{l(\mathbf{x}))}(\mathbf{x})))
\end{equation}
\end{frame}


\begin{frame}
\vspace{-0.1cm}
{\noindent\large\textbf{权重函数}}
\vspace{0.4cm}



%\begin{figure}
%   \vspace{-0.2cm}  %调整图片与上文的垂直距离
%   \setlength{\belowcaptionskip}{-0.4cm}   %调整图片标题与下文距离
%   \setlength{\abovecaptionskip}{0.4cm}   %调整图片标题与下文距离
%  \centering%
%    \hspace{0.05cm}\includegraphics[width=0.2\linewidth]{DIC-C2DH-HeLa-02-t038.png}
%    \hspace{0.05cm}\includegraphics[width=0.2\linewidth]{DIC-C2DH-HeLa-02-t038-overlay.png}\\
%    \hspace{0.05cm}\includegraphics[width=0.2\linewidth]{DIC-C2DH-HeLa-02-t038-mask.png}
%    \hspace{0.05cm}\includegraphics[width=0.2\linewidth]{weightmap.png}
%\caption*{\footnotesize{
%用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
%%HeLa cells on glass recorded with DIC (differential interference contrast) microscopy. (a) raw image. (b) overlay with ground truth segmentation. Different colors indicate different instances of the HeLa cells. (c) generated segmentation mask (white: foreground, black: background). (d) map with a pixel-wise loss weight to force the network to learn the border pixels.
%}}
%\label{fig:fastdata}
%\end{figure}

\begin{columns}
\vspace{-0.5cm}
	\begin{column}{0.6\linewidth}

\begin{figure}
   \vspace{-0.2cm}  %调整图片与上文的垂直距离
   \setlength{\belowcaptionskip}{-0.4cm}   %调整图片标题与下文距离
   \setlength{\abovecaptionskip}{0.4cm}   %调整图片标题与下文距离
  \centering%
    \hspace{0.05cm}\includegraphics[width=0.34\linewidth]{DIC-C2DH-HeLa-02-t038.png}
    \hspace{0.05cm}\includegraphics[width=0.34\linewidth]{DIC-C2DH-HeLa-02-t038-overlay.png}\\
    \hspace{0.05cm}\includegraphics[width=0.34\linewidth]{DIC-C2DH-HeLa-02-t038-mask.png}
    \hspace{0.05cm}\includegraphics[width=0.34\linewidth]{weightmap.png}
%\caption*{\footnotesize{用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
%HeLa cells on glass recorded with DIC (differential interference contrast) microscopy. (a) raw image. (b) overlay with ground truth segmentation. Different colors indicate different instances of the HeLa cells. (c) generated segmentation mask (white: foreground, black: background). (d) map with a pixel-wise loss weight to force the network to learn the border pixels.
%}}
\label{fig:fastdata}
\end{figure}

	\end{column}

	\begin{column}{0.4\linewidth}
   \footnotesize
			用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
	\end{column}
\end{columns}


{\setlength\abovedisplayskip{0.1cm}
\setlength\belowdisplayskip{0.1cm}
\begin{equation}\label{equ:weights}
    w(\mathbf{x}) = w_c(\mathbf{x}) + w_0 \cdot exp(-\frac{ (d_1 (\mathbf{x}) + d_2(\mathbf{x}) )^2  }{2\sigma^2})
\end{equation}
}
$d_1$和$d_2$分别表示一个像素距离最近和第二近细胞的边界的距离。


\end{frame}




\section{数据预处理与数据增强}
\begin{frame}[allowframebreaks]
  \frametitle{\textsc{目录}} \vspace{-0.3cm}
    \begin{spacing}{0.0}
        \tableofcontents[currentsection,hideallsubsections]
    \end{spacing}   % 若不想要目录, 注释掉该句
\end{frame}

\begin{frame}
%\vspace{-0.1cm}
%{\noindent\large\textbf{数据增强}}
%\vspace{0.4cm}



%\begin{figure}
%   \vspace{-0.2cm}  %调整图片与上文的垂直距离
%   \setlength{\belowcaptionskip}{-0.4cm}   %调整图片标题与下文距离
%   \setlength{\abovecaptionskip}{0.4cm}   %调整图片标题与下文距离
%  \centering%
%    \hspace{0.05cm}\includegraphics[width=0.2\linewidth]{DIC-C2DH-HeLa-02-t038.png}
%    \hspace{0.05cm}\includegraphics[width=0.2\linewidth]{DIC-C2DH-HeLa-02-t038-overlay.png}\\
%    \hspace{0.05cm}\includegraphics[width=0.2\linewidth]{DIC-C2DH-HeLa-02-t038-mask.png}
%    \hspace{0.05cm}\includegraphics[width=0.2\linewidth]{weightmap.png}
%\caption*{\footnotesize{
%用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
%%HeLa cells on glass recorded with DIC (differential interference contrast) microscopy. (a) raw image. (b) overlay with ground truth segmentation. Different colors indicate different instances of the HeLa cells. (c) generated segmentation mask (white: foreground, black: background). (d) map with a pixel-wise loss weight to force the network to learn the border pixels.
%}}
%\label{fig:fastdata}
%\end{figure}

\begin{columns}
\vspace{-0.5cm}
	\begin{column}{0.6\linewidth}

\begin{figure}
   \vspace{-0.2cm}  %调整图片与上文的垂直距离
   \setlength{\belowcaptionskip}{-0.4cm}   %调整图片标题与下文距离
   \setlength{\abovecaptionskip}{0.4cm}   %调整图片标题与下文距离
  \centering%
    \hspace{0.05cm}\includegraphics[width=0.34\linewidth]{DIC-C2DH-HeLa-02-t038.png}
    \hspace{0.05cm}\includegraphics[width=0.34\linewidth]{DIC-C2DH-HeLa-02-t038-overlay.png}\\
    \hspace{0.05cm}\includegraphics[width=0.34\linewidth]{DIC-C2DH-HeLa-02-t038-mask.png}
    \hspace{0.05cm}\includegraphics[width=0.34\linewidth]{weightmap.png}
%\caption*{\footnotesize{用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
%HeLa cells on glass recorded with DIC (differential interference contrast) microscopy. (a) raw image. (b) overlay with ground truth segmentation. Different colors indicate different instances of the HeLa cells. (c) generated segmentation mask (white: foreground, black: background). (d) map with a pixel-wise loss weight to force the network to learn the border pixels.
%}}
\label{fig:fastdata}
\end{figure}

	\end{column}

	\begin{column}{0.4\linewidth}
   \footnotesize
			用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
	\end{column}
\end{columns}

\vspace{0.2cm}

数据量与经验\\
平移、旋转、形态


\end{frame}


\begin{frame}
%\vspace{-0.1cm}
%{\noindent\large\textbf{数据增强}}
%\vspace{0.4cm}


%\begin{columns}
%\vspace{-0.5cm}
%	\begin{column}{0.6\linewidth}
%
%
%\end{figure}
%
%	\end{column}
%
%	\begin{column}{0.4\linewidth}
%   \footnotesize
%			用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
%	\end{column}
%\end{columns}

\begin{figure}
   \vspace{-0.2cm}  %调整图片与上文的垂直距离
   \setlength{\belowcaptionskip}{-0.4cm}   %调整图片标题与下文距离
   \setlength{\abovecaptionskip}{0.4cm}   %调整图片标题与下文距离
  \centering%
    \hspace{0.05cm}\includegraphics[width=0.8\linewidth]{Distortions.jpg}\\
    %\hspace{0.05cm}\includegraphics[width=0.34\linewidth]{UnusualDistortionNoises.png}%\\
%\caption*{\footnotesize{用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
%HeLa cells on glass recorded with DIC (differential interference contrast) microscopy. (a) raw image. (b) overlay with ground truth segmentation. Different colors indicate different instances of the HeLa cells. (c) generated segmentation mask (white: foreground, black: background). (d) map with a pixel-wise loss weight to force the network to learn the border pixels.
%}}
\label{fig:fastdata}
\end{figure}

\vspace{0.2cm}

数据量与经验\\
平移、旋转、形态


\end{frame}


\begin{frame}
%\vspace{-0.1cm}
%{\noindent\large\textbf{数据增强}}
%\vspace{0.4cm}


%\begin{columns}
%\vspace{-0.5cm}
%	\begin{column}{0.6\linewidth}
%
%
%\end{figure}
%
%	\end{column}
%
%	\begin{column}{0.4\linewidth}
%   \footnotesize
%			用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
%	\end{column}
%\end{columns}

\begin{figure}
   \vspace{-0.2cm}  %调整图片与上文的垂直距离
   \setlength{\belowcaptionskip}{-0.4cm}   %调整图片标题与下文距离
   \setlength{\abovecaptionskip}{0.4cm}   %调整图片标题与下文距离
  \centering%
    %\hspace{0.05cm}\includegraphics[width=0.34\linewidth]{Distortions.jpg}\\
    \hspace{0.05cm}\includegraphics[width=0.7\linewidth]{UnusualDistortionNoises.png}%\\
%\caption*{\footnotesize{用DIC（差分干涉对比度）显微镜记录玻璃上的HeLa细胞。(a)原始图像。(b)参考分割结果。不同的颜色表示HeLa细胞的不同实例。(c)生成的分割掩码（白色：前景，黑色：背景）。(d)像素级的损失权重，以促使网络模型更好地学习识别边界像素。图像数据来自文献\citet{Unet2015Olaf}
%HeLa cells on glass recorded with DIC (differential interference contrast) microscopy. (a) raw image. (b) overlay with ground truth segmentation. Different colors indicate different instances of the HeLa cells. (c) generated segmentation mask (white: foreground, black: background). (d) map with a pixel-wise loss weight to force the network to learn the border pixels.
%}}
\label{fig:fastdata}
\end{figure}

\vspace{0.2cm}

数据量与经验\\
平移、旋转、形态


\end{frame}




\section{探讨与扩展阅读}
\begin{frame}[allowframebreaks]
  \frametitle{\textsc{目录}} \vspace{-0.3cm}
    \begin{spacing}{0.0}
        \tableofcontents[currentsection,hideallsubsections]
    \end{spacing}   % 若不想要目录, 注释掉该句
\end{frame}


\begin{frame}[allowframebreaks]
\vspace{-0.1cm}
{\noindent\large\textbf{探讨与扩展阅读}}
\vspace{0.4cm}
%\tiny
\begin{itemize}
    \item[*] U-Net: Convolutional Networks for Biomedical Image Segmentation \citep{Unet2015Olaf}
    \item[*] nnU-Net: a self-configuring method for deep learning-based biomedical image segmentation \citep{Isensee2021NM}
    \item[*] nnU-Net: Self-adapting Framework for U-Net-Based Medical Image Segmentation \citep{Isensee2019}.
\end{itemize}
\end{frame}




\section{思考题}
\begin{frame}[allowframebreaks]
  \frametitle{\textsc{目录}} \vspace{-0.3cm}
    \begin{spacing}{0.0}
        \tableofcontents[currentsection,hideallsubsections]
    \end{spacing}   % 若不想要目录, 注释掉该句
\end{frame}


\begin{frame}[allowframebreaks]
\vspace{-0.1cm}
{\noindent\large\textbf{思考题(选做)}}
\vspace{0.4cm}
\begin{itemize}
    \item[9.1] 请参考文献\citet{Unet2015Olaf}和网上调研，在课程提供的U-Net参考代码基础上添加数据增强模块，并测试和撰写简要说明。
    \item[9.2] 请尝试在课程提供的U-Net参考代码基础上添加公式(\ref{equ:weights})中的权重， 并测试和撰写简要说明。
\end{itemize}
\end{frame}







\section{Reference}

\begin{frame}[allowframebreaks]{参考文献}
	\vspace{-0.3cm}
	\scriptsize%\tiny\scriptsize\footnotesize\small\normalsize\large\Large\LARGE\huge\Huge
	\normalem
	\bibliographystyle{apalike}%{mnras}
	\bibliography{example} % if your bibtex file is called example.bib
\end{frame}


\end{document}
